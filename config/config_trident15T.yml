# general 
credentials_file: ~/.uwo_credentials.bd
final_bids_dir: "bids"

# 1. query
search_specs:
  - dicom_query:
      study_description: Prado^*
      study_date: 20230101-
    metadata_mappings:
      subject:
        source: PatientID
        pattern: '_([^_]+)$'
        sanitize: true
      session:
        source: StudyDate

  - dicom_query:
      study_description: Menon^*
      study_date: 20230101-
      patient_name: AppKI2.hTau.*
    metadata_mappings:
      subject:
        source: PatientID
        pattern: '_([^_]+)$'
        sanitize: true
      session:
        source: StudyDate
 
query_kwargs:
  additional_tags:
    "00100030": PatientBirthDate
  


# 2. filter
study_filter_specs:
  include:
  exclude:
    - StudyInstanceUID == '2.16.756.5.5.200.8323328.24337.1724894202.13553'
    - StudyInstanceUID == '2.16.756.5.5.200.8323328.1680611.1757603627.25146'
    - StudyInstanceUID == '2.16.756.5.5.200.8323328.46598.1721528003.6342'
  remap_sessions_by_date:
    # Enable/disable session remapping (REQUIRED if section is present)
    enable: true
    # Time units for intervals (OPTIONAL, default: 'months')
    # Options: 'days', 'months', 'years'
    units: 'months'
    
    # Rounding step for time intervals (OPTIONAL, default: 6)
    # For example, with units='months' and round_step=1:
    #   - Sessions will be labeled by rounded month intervals (0m, 1m, 2m, etc.)
    round_step: 1
    
    # Zero-pad session labels (OPTIONAL, default: false)
    # If true, pads session labels with leading zeros for proper alphanumeric sorting
    # Example: '00m', '06m', '12m' instead of '0m', '6m', '12m'
    # zero_pad: false
    
    # Reference date mode (OPTIONAL)
    # Default (commented out): Uses first session per subject as reference (baseline mode)
    # Alternative: Use PatientBirthDate to calculate age at scan
    # reference_col: 'PatientBirthDate'
    # reference_format: '%Y%m%d'
 
    # Mapping from numeric time intervals to session labels (OPTIONAL)
    # If not specified, generates labels like '0m', '6m', '12m' automatically
    # Custom mapping example (e.g., for time since baseline):
    time_to_label:
      0: 'baseline'
 
# 3. download
cfmm2tar_download_options: '--skip-derived'
merge_duplicate_studies: False  



# 4. convert
heudiconv_options: '--minmeta --use-enhanced-dicom --no-sanitize-jsons'
heuristic: heuristics/trident_15T.py
dcmconfig_json: resources/dcm2niix_config.json



# 5. fix 
post_convert_fixes:
  - name: phase_units
    pattern: "*/*_part-phase_*.json"
    action: update_json
    updates:
      Units: rad

  - name: reset_orientation
    pattern: "*/*.nii.gz"
    action: fix_orientation_quadruped


#intermediate output folders
stages:
  query: "/nfs/trident3/mri/cfmm2bids/results/0_query"
  filter: "results/1_filter"
  download: "/nfs/trident3/mri/cfmm2bids/results/2_download"
  convert: "/nfs/trident3/mri/cfmm2bids/results/3_convert"
  fix: "/nfs/trident3/mri/cfmm2bids/results/4_fix"


